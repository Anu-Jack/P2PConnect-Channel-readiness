import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { CheckCircle2, Download } from "lucide-react";

// Weighted sections for Channel Ops assessment
const sections = [
  {
    title: "Strategy & Ownership",
    weight: 25,
    items: [
      "Channel defined as a growth pillar with revenue targets",
      "Clear partner types & market segmentation",
      "Defined ICP & target customer segments",
      "Dedicated channel owner & leadership commitment",
    ],
  },
  {
    title: "Legal, Commercial & Incentives",
    weight: 20,
    items: [
      "Channel framework agreement in place",
      "Clear commission & incentive plan",
      "Deal registration & conflict protection",
      "Defined margins & governance clauses",
    ],
  },
  {
    title: "Onboarding, Enablement & Certification",
    weight: 15,
    items: [
      "Standard partner onboarding framework",
      "Sales / Pre-sales / Delivery certification",
      "Partner-ready pitch deck & one-pager",
      "Ongoing training & roadmap updates",
    ],
  },
  {
    title: "Sales & Operating Model",
    weight: 15,
    items: [
      "Channel RACI matrix defined",
      "Co-sell vs independent sell clarity",
      "Partner team & roles defined (Sales, Pre-Sales, Success Manager)",
      "Operating model to work with end-customer teams",
      "Qualification & opportunity ownership defined",
    ],
  },
  {
    title: "Product, Demo & Support Readiness",
    weight: 15,
    items: [
      "Partner demo / sandbox environment",
      "Clear demo access model",
            "Ticketing, escalation & SLA model",
      "Demand Gen support for partners (leads, GTM funds, campaigns)",
      "Customer-ready pitch deck & FAQs for partners",
    ],
  },
  {
    title: "Partner Management & Scale",
    weight: 10,
    items: [
      "PRM system in place",
      "Partner KPIs tracked",
      "Conflict management & escalation process from partners",
      "Regular partner performance reviews",
      "Clear criteria to scale or exit partners",
    ],
  },
];

export default function ChannelReadinessApp() {
  const [checked, setChecked] = useState({});

  const toggle = (key) => {
    setChecked((prev) => ({ ...prev, [key]: !prev[key] }));
  };

  const sectionScores = sections.map((section, i) => {
    const total = section.items.length;
    const completed = section.items.filter((_, j) => checked[`${i}-${j}`]).length;
    const percent = total === 0 ? 0 : completed / total;
    return {
      title: section.title,
      weight: section.weight,
      score: Math.round(percent * section.weight),
    };
  });

  const totalScore = sectionScores.reduce((sum, s) => sum + s.score, 0);

  const readiness =
    totalScore >= 75 ? "Channel-Ready" : totalScore >= 45 ? "Partially Ready" : "Not Channel-Ready";

  const exportPDF = () => {
    window.print();
  };

  return (
    <div className="p-6 max-w-6xl mx-auto space-y-6">
      <h1 className="text-3xl font-semibold">Channel Readiness Assessment â€“ Ops View</h1>
      <p className="text-muted-foreground">
        Weighted assessment designed for Channel Heads & Operations leaders.
      </p>

      <div className="grid md:grid-cols-2 gap-6">
        {sections.map((section, i) => (
          <Card key={i} className="rounded-2xl shadow-sm">
            <CardContent className="p-5 space-y-3">
              <div className="flex justify-between items-center">
                <h2 className="text-xl font-medium">{section.title}</h2>
                <span className="text-xs text-muted-foreground">Weight: {section.weight}%</span>
              </div>
              {section.items.map((item, j) => {
                const key = `${i}-${j}`;
                return (
                  <div
                    key={key}
                    className="flex items-start gap-3 cursor-pointer"
                    onClick={() => toggle(key)}
                  >
                    <CheckCircle2
                      className={`mt-1 h-5 w-5 transition ${
                        checked[key] ? "text-green-600" : "text-gray-300"
                      }`}
                    />
                    <span className="text-sm">{item}</span>
                  </div>
                );
              })}
            </CardContent>
          </Card>
        ))}
      </div>

      <Card className="rounded-2xl">
        <CardContent className="p-6 space-y-4">
          <div className="flex justify-between items-center">
            <h3 className="text-lg font-medium">Weighted Score Summary</h3>
            <div className="text-3xl font-semibold">{totalScore} / 100</div>
          </div>

          <div className="grid md:grid-cols-3 gap-4">
            {sectionScores.map((s, i) => (
              <div key={i} className="text-sm flex justify-between">
                <span>{s.title}</span>
                <span className="font-medium">{s.score}%</span>
              </div>
            ))}
          </div>

          <div
            className={`text-sm font-semibold ${
              readiness === "Channel-Ready"
                ? "text-green-600"
                : readiness === "Partially Ready"
                ? "text-amber-600"
                : "text-red-600"
            }`}
          >
            Overall Status: {readiness}
          </div>
        </CardContent>
      </Card>

      <div className="flex justify-end gap-3">
        <Button onClick={exportPDF} className="rounded-xl flex gap-2">
          <Download className="h-4 w-4" /> Export PDF
        </Button>
      </div>
    </div>
  );
}
